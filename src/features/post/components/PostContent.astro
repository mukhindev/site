---
import { type CollectionEntry, render } from "astro:content";
import type { HTMLAttributes } from "astro/types";
import Tag from "../../../shared/ui/Tag.astro";
import { findOrCreateTagByName } from "../../../tags";

interface Props extends HTMLAttributes<"article"> {
  post: CollectionEntry<"posts">;
}

const { class: className, post, ...attrs } = Astro.props;

const { Content } = await render(post);
const tags = post.data.tags.map((tag) => findOrCreateTagByName(tag)!);
---

<article class:list={["post-content", className]} {...attrs}>
  <h1>{post.data.title}</h1>
  {tags.map((tag) => <Tag label={tag?.name} href={`/tags/${tag?.slug}`} />)}
  <Content />
</article>

<style>
  .post-content {
    /* Элемент внутри генерируется из .md-файлов через rehype */

    /*
     * Блоки кода ```js```. Переопределение темы shiki
     * (см. astro.config.mjs -> defineConfig() -> markdown.shikiConfig.theme)
     */
    .astro-code.css-variables {
      --astro-code-background: #ffffff;
      --astro-code-foreground: #000000;

      --astro-code-token-comment: #008000;
      --astro-code-token-string: #a31515;
      --astro-code-token-keyword: #0000ff;
      --astro-code-token-constant: #007acc;
      --astro-code-token-function: #795e26;
      --astro-code-token-parameter: #001080;
      --astro-code-token-punctuation: #000000;
      --astro-code-token-operator: #000000;
      --astro-code-token-number: #098658;
      --astro-code-token-regexp: #811f3f;
      --astro-code-token-variable: #001080;
      --astro-code-token-type: #267f99;

      font-family: var(--font-code), monospace;
      font-variant-ligatures: none;
      font-size: 0.875rem;
      background-color: unset;
    }

    /* Код в тексте `text` */
    code {
      font-family: var(--font-code), monospace;
      font-variant-ligatures: none;
    }

    p code {
      font-family: var(--font-code), monospace;
      font-variant-ligatures: none;
      font-size: 0.875rem;
      background-color: var(--surface);
      color: var(--on-surface);
      padding: 0 0.25rem;
      border-radius: 4px;
    }

    /** Стресс _text_ */
    em {
      font-family: var(--font-code), monospace;
      font-variant-ligatures: none;
      font-size: 0.875em;
      font-style: italic;
    }
  }

  html.dark {
    .post-content {
      .astro-code.css-variables {
        --astro-code-background: #1e1e1e;
        --astro-code-foreground: #d4d4d4;

        --astro-code-token-comment: #6a9955;
        --astro-code-token-string: #ce9178;
        --astro-code-token-keyword: #c586c0;
        --astro-code-token-constant: #9cdcfe;
        --astro-code-token-function: #dcdcaa;
        --astro-code-token-parameter: #9cdcfe;
        --astro-code-token-punctuation: #d4d4d4;
        --astro-code-token-operator: #d4d4d4;
        --astro-code-token-number: #b5cea8;
        --astro-code-token-regexp: #d16969;
        --astro-code-token-variable: #9cdcfe;
        --astro-code-token-type: #4ec9b0;
      }
    }
  }
</style>
